<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ - Î†àÌä∏Î°ú ÏïÑÏºÄÏù¥Îìú</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        const RaccoonGame = () => {
            const GRID_SIZE = 15;
            const CELL_SIZE = 40;
            
            // Firebase ÏÑ§Ï†ï (Ïã§Ï†ú ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥Î°ú ÍµêÏ≤¥ ÌïÑÏöî)
            const FIREBASE_CONFIG = {
                apiKey: "AIzaSyDSXQvomvJ4bqw7-akkDYiSHzLtR68b7zo",
  authDomain: "racoon-4ca01.firebaseapp.com",
  databaseURL: "https://racoon-4ca01-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "racoon-4ca01",
  storageBucket: "racoon-4ca01.firebasestorage.app",
  messagingSenderId: "638830629964",
  appId: "1:638830629964:web:191a57684125cae3ce50e9"
}
            // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userName, setUserName] = useState('');
            const [studentId, setStudentId] = useState('');
            const [tempName, setTempName] = useState('');
            const [tempStudentId, setTempStudentId] = useState('');
            
            const [gameState, setGameState] = useState('menu');
            const [level, setLevel] = useState(1);
            const [score, setScore] = useState(0);
            const [lives, setLives] = useState(3);
            const [playerPos, setPlayerPos] = useState({ x: 1, y: 1 });
            const [fruits, setFruits] = useState([]);
            const [tacks, setTacks] = useState([]);
            const [invincible, setInvincible] = useState(false);
            const [rankings, setRankings] = useState([]);
            const [showRankings, setShowRankings] = useState(false);

            // Firebase Ï†êÏàò Ï†ÄÏû•
            const saveScore = async (name, studentId, score, level) => {
                try {
                    const response = await fetch(`${FIREBASE_CONFIG.databaseURL}/scores.json`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name,
                            studentId,
                            score,
                            level,
                            timestamp: Date.now()
                        })
                    });
                    
                    if (response.ok) {
                        loadRankings();
                    }
                } catch (error) {
                    console.error('Ï†êÏàò Ï†ÄÏû• Ïã§Ìå®:', error);
                }
            };

            // Firebase Îû≠ÌÇπ Î∂àÎü¨Ïò§Í∏∞
            const loadRankings = async () => {
                try {
                    const response = await fetch(`${FIREBASE_CONFIG.databaseURL}/scores.json`);
                    const data = await response.json();
                    
                    if (data) {
                        const scoresArray = Object.values(data)
                            .sort((a, b) => b.score - a.score)
                            .slice(0, 10);
                        setRankings(scoresArray);
                    }
                } catch (error) {
                    console.error('Îû≠ÌÇπ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
                }
            };

            // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
            const handleLogin = () => {
                if (tempName.trim() && tempStudentId.trim()) {
                    setUserName(tempName);
                    setStudentId(tempStudentId);
                    setIsLoggedIn(true);
                    loadRankings();
                }
            };

            // Î°úÍ∑∏ÏïÑÏõÉ Ï≤òÎ¶¨
            const handleLogout = () => {
                setIsLoggedIn(false);
                setUserName('');
                setStudentId('');
                setGameState('menu');
                setScore(0);
                setLevel(1);
                setLives(3);
            };

            // Î†àÎ≤® Ï¥àÍ∏∞Ìôî
            const initLevel = useCallback((levelNum) => {
                const newFruits = [];
                const newTacks = [];
                
                const fruitCount = 5 + levelNum * 2;
                for (let i = 0; i < fruitCount; i++) {
                    let pos;
                    do {
                        pos = {
                            x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                            y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                        };
                    } while (
                        (pos.x === 1 && pos.y === 1) ||
                        newFruits.some(f => f.x === pos.x && f.y === pos.y)
                    );
                    newFruits.push(pos);
                }
                
                const tackCount = 8 + levelNum * 3;
                for (let i = 0; i < tackCount; i++) {
                    let pos;
                    do {
                        pos = {
                            x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                            y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                        };
                    } while (
                        (pos.x === 1 && pos.y === 1) ||
                        newFruits.some(f => f.x === pos.x && f.y === pos.y) ||
                        newTacks.some(t => t.x === pos.x && t.y === pos.y)
                    );
                    newTacks.push(pos);
                }
                
                setFruits(newFruits);
                setTacks(newTacks);
                setPlayerPos({ x: 1, y: 1 });
            }, []);

            // Í≤åÏûÑ ÏãúÏûë
            const startGame = () => {
                setGameState('playing');
                setLevel(1);
                setScore(0);
                setLives(3);
                setShowRankings(false);
                initLevel(1);
            };

            // ÌÇ§Î≥¥Îìú Ï°∞Ïûë
            useEffect(() => {
                if (gameState !== 'playing') return;

                const handleKeyPress = (e) => {
                    const { x, y } = playerPos;
                    let newX = x;
                    let newY = y;

                    switch(e.key) {
                        case 'ArrowUp':
                            newY = Math.max(0, y - 1);
                            break;
                        case 'ArrowDown':
                            newY = Math.min(GRID_SIZE - 1, y + 1);
                            break;
                        case 'ArrowLeft':
                            newX = Math.max(0, x - 1);
                            break;
                        case 'ArrowRight':
                            newX = Math.min(GRID_SIZE - 1, x + 1);
                            break;
                        default:
                            return;
                    }

                    e.preventDefault();
                    setPlayerPos({ x: newX, y: newY });
                };

                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [playerPos, gameState]);

            // Ï∂©Îèå Ï≤¥ÌÅ¨ Î∞è ÏïÑÏù¥ÌÖú ÏàòÏßë
            useEffect(() => {
                if (gameState !== 'playing') return;

                const fruitIndex = fruits.findIndex(f => f.x === playerPos.x && f.y === playerPos.y);
                if (fruitIndex !== -1) {
                    setFruits(fruits.filter((_, i) => i !== fruitIndex));
                    setScore(score + 100);
                    
                    if (fruits.length === 1) {
                        setTimeout(() => {
                            setLevel(level + 1);
                            initLevel(level + 1);
                            setScore(score + 500);
                        }, 300);
                    }
                }

                if (!invincible) {
                    const hitTack = tacks.some(t => t.x === playerPos.x && t.y === playerPos.y);
                    if (hitTack) {
                        setLives(lives - 1);
                        setInvincible(true);
                        
                        if (lives <= 1) {
                            setGameState('lost');
                            saveScore(userName, studentId, score, level);
                        } else {
                            setTimeout(() => {
                                setInvincible(false);
                            }, 1000);
                        }
                    }
                }
            }, [playerPos, fruits, tacks, gameState, score, lives, level, invincible, initLevel, userName, studentId]);

            // Í≤åÏûÑ ÌôîÎ©¥ Î†åÎçîÎßÅ
            const renderGrid = () => {
                const cells = [];
                
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const isPlayer = playerPos.x === x && playerPos.y === y;
                        const isFruit = fruits.some(f => f.x === x && f.y === y);
                        const isTack = tacks.some(t => t.x === x && t.y === y);
                        const isWall = x === 0 || y === 0 || x === GRID_SIZE - 1 || y === GRID_SIZE - 1;
                        
                        cells.push(
                            React.createElement('div', {
                                key: `${x}-${y}`,
                                style: {
                                    width: CELL_SIZE,
                                    height: CELL_SIZE,
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontSize: '24px',
                                    backgroundColor: isWall ? '#8B4513' : '#90EE90',
                                    border: '1px solid #006400',
                                    opacity: invincible && isPlayer ? (Date.now() % 400 < 200 ? 0.3 : 1) : 1,
                                }
                            },
                                isPlayer && 'ü¶ù',
                                isFruit && 'üçé',
                                isTack && 'üìç'
                            )
                        );
                    }
                }
                
                return cells;
            };

            // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥
            if (!isLoggedIn) {
                return React.createElement('div', {
                    style: { 
                        width: '100vw', 
                        height: '100vh', 
                        display: 'flex', 
                        alignItems: 'center',
                        justifyContent: 'center',
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                    }
                },
                    React.createElement('div', {
                        style: {
                            backgroundColor: 'white',
                            borderRadius: '20px',
                            padding: '40px',
                            width: '400px',
                            boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
                        }
                    },
                        React.createElement('h1', {
                            style: {
                                textAlign: 'center',
                                fontSize: '36px',
                                marginBottom: '30px',
                                color: '#667eea'
                            }
                        }, 'ü¶ù ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ Î°úÍ∑∏Ïù∏'),
                        
                        React.createElement('div', { style: { marginBottom: '20px' } },
                            React.createElement('label', {
                                style: {
                                    display: 'block',
                                    fontSize: '14px',
                                    fontWeight: 'bold',
                                    marginBottom: '8px',
                                    color: '#333'
                                }
                            }, 'Ïù¥Î¶Ñ'),
                            React.createElement('input', {
                                type: 'text',
                                value: tempName,
                                onChange: (e) => setTempName(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && handleLogin(),
                                placeholder: 'Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                                style: {
                                    width: '100%',
                                    padding: '12px',
                                    fontSize: '16px',
                                    border: '2px solid #ddd',
                                    borderRadius: '8px',
                                    boxSizing: 'border-box'
                                }
                            })
                        ),
                        
                        React.createElement('div', { style: { marginBottom: '30px' } },
                            React.createElement('label', {
                                style: {
                                    display: 'block',
                                    fontSize: '14px',
                                    fontWeight: 'bold',
                                    marginBottom: '8px',
                                    color: '#333'
                                }
                            }, 'ÌïôÎ≤à'),
                            React.createElement('input', {
                                type: 'text',
                                value: tempStudentId,
                                onChange: (e) => setTempStudentId(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && handleLogin(),
                                placeholder: 'ÌïôÎ≤àÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                                style: {
                                    width: '100%',
                                    padding: '12px',
                                    fontSize: '16px',
                                    border: '2px solid #ddd',
                                    borderRadius: '8px',
                                    boxSizing: 'border-box'
                                }
                            })
                        ),
                        
                        React.createElement('button', {
                            onClick: handleLogin,
                            style: {
                                width: '100%',
                                padding: '15px',
                                fontSize: '18px',
                                fontWeight: 'bold',
                                backgroundColor: '#667eea',
                                color: 'white',
                                border: 'none',
                                borderRadius: '8px',
                                cursor: 'pointer'
                            }
                        }, 'Í≤åÏûÑ ÏãúÏûë')
                    )
                );
            }

            // Î©îÏù∏ Í≤åÏûÑ ÌôîÎ©¥
            return React.createElement('div', {
                style: { 
                    width: '100vw', 
                    height: '100vh', 
                    display: 'flex', 
                    flexDirection: 'column',
                    alignItems: 'center', 
                    justifyContent: 'center',
                    backgroundColor: '#1a1a2e',
                    fontFamily: 'Arial, sans-serif',
                    color: 'white'
                }
            },
                // ÏÉÅÎã® ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞î
                React.createElement('div', {
                    style: {
                        position: 'absolute',
                        top: '20px',
                        right: '20px',
                        display: 'flex',
                        gap: '15px',
                        alignItems: 'center',
                        backgroundColor: 'rgba(255,255,255,0.1)',
                        padding: '10px 20px',
                        borderRadius: '10px'
                    }
                },
                    React.createElement('span', {
                        style: { fontSize: '16px', fontWeight: 'bold' }
                    }, `üë§ ${userName} (${studentId})`),
                    React.createElement('button', {
                        onClick: handleLogout,
                        style: {
                            padding: '8px 15px',
                            backgroundColor: '#FF6B6B',
                            color: 'white',
                            border: 'none',
                            borderRadius: '5px',
                            cursor: 'pointer',
                            fontSize: '14px'
                        }
                    }, 'Î°úÍ∑∏ÏïÑÏõÉ')
                ),

                // Î©îÎâ¥ ÌôîÎ©¥
                gameState === 'menu' && React.createElement('div', { style: { textAlign: 'center' } },
                    React.createElement('h1', { 
                        style: { fontSize: '48px', marginBottom: '20px', color: '#FFD700' }
                    }, 'ü¶ù ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ üçé'),
                    React.createElement('p', { 
                        style: { fontSize: '20px', marginBottom: '30px' }
                    }, 'ÏïïÏ†ïÏùÑ ÌîºÌïòÍ≥† Í≥ºÏùºÏùÑ Î™®Îëê Î®πÏúºÏÑ∏Ïöî!'),
                    React.createElement('div', { 
                        style: { marginBottom: '30px', textAlign: 'left', display: 'inline-block' }
                    },
                        React.createElement('p', null, 'ü¶ù ÎÑàÍµ¨Î¶¨: ÌîåÎ†àÏù¥Ïñ¥'),
                        React.createElement('p', null, 'üçé Í≥ºÏùº: 100Ï†ê (Î™®Îëê Î®πÏúºÎ©¥ Îã§Ïùå Ïä§ÌÖåÏù¥ÏßÄ!)'),
                        React.createElement('p', null, 'üìç ÏïïÏ†ï: ÎãøÏúºÎ©¥ ÏÉùÎ™Ö -1'),
                        React.createElement('p', null, '‚å®Ô∏è ÌôîÏÇ¥Ìëú ÌÇ§Î°ú Ï°∞Ïûë')
                    ),
                    React.createElement('br'),
                    React.createElement('div', {
                        style: { display: 'flex', gap: '20px', justifyContent: 'center' }
                    },
                        React.createElement('button', {
                            onClick: startGame,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#FFD700',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'üéÆ Í≤åÏûÑ ÏãúÏûë'),
                        React.createElement('button', {
                            onClick: () => {
                                setShowRankings(!showRankings);
                                if (!showRankings) loadRankings();
                            },
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#4ECDC4',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, showRankings ? 'üéÆ Í≤åÏûÑÏúºÎ°ú' : 'üèÜ Îû≠ÌÇπ Î≥¥Í∏∞')
                    ),
                    
                    // Îû≠ÌÇπ ÌëúÏãú
                    showRankings && React.createElement('div', {
                        style: {
                            marginTop: '40px',
                            backgroundColor: 'rgba(255,255,255,0.1)',
                            padding: '30px',
                            borderRadius: '15px',
                            minWidth: '500px'
                        }
                    },
                        React.createElement('h2', {
                            style: { fontSize: '32px', marginBottom: '20px', color: '#FFD700' }
                        }, 'üèÜ ÏµúÍ≥† Ï†êÏàò Îû≠ÌÇπ'),
                        rankings.length === 0 ? 
                            React.createElement('p', {
                                style: { textAlign: 'center', color: '#aaa' }
                            }, 'ÏïÑÏßÅ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§') :
                            rankings.map((rank, index) => 
                                React.createElement('div', {
                                    key: index,
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        padding: '15px',
                                        marginBottom: '10px',
                                        backgroundColor: index === 0 ? 'rgba(255,215,0,0.2)' : 
                                                       index === 1 ? 'rgba(192,192,192,0.2)' :
                                                       index === 2 ? 'rgba(205,127,50,0.2)' :
                                                       'rgba(255,255,255,0.05)',
                                        borderRadius: '10px',
                                        fontSize: '18px'
                                    }
                                },
                                    React.createElement('span', { style: { fontWeight: 'bold' } }, 
                                        `${index + 1}ÏúÑ`),
                                    React.createElement('span', null, 
                                        `${rank.name} (${rank.studentId})`),
                                    React.createElement('span', { style: { color: '#4ECDC4', fontWeight: 'bold' } }, 
                                        `${rank.score}Ï†ê`),
                                    React.createElement('span', { style: { color: '#aaa', fontSize: '14px' } }, 
                                        `Lv.${rank.level}`)
                                )
                            )
                    )
                ),

                // ÌîåÎ†àÏù¥ ÌôîÎ©¥
                gameState === 'playing' && React.createElement('div', null,
                    React.createElement('div', { 
                        style: { 
                            display: 'flex', 
                            justifyContent: 'space-between', 
                            marginBottom: '20px',
                            fontSize: '24px',
                            fontWeight: 'bold'
                        }
                    },
                        React.createElement('div', { style: { display: 'flex', gap: '30px' } },
                            React.createElement('span', null, `‚≠ê Î†àÎ≤®: ${level}`),
                            React.createElement('span', null, `üèÜ Ï†êÏàò: ${score}`),
                            React.createElement('span', null, `‚ù§Ô∏è ÏÉùÎ™Ö: ${lives}`)
                        ),
                        React.createElement('div', null, `üçé ÎÇ®ÏùÄ Í≥ºÏùº: ${fruits.length}`)
                    ),
                    
                    React.createElement('div', { 
                        style: { 
                            display: 'grid', 
                            gridTemplateColumns: `repeat(${GRID_SIZE}, ${CELL_SIZE}px)`,
                            gap: '0',
                            border: '4px solid #FFD700',
                            boxShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                        }
                    }, renderGrid()),
                    
                    React.createElement('div', { 
                        style: { 
                            marginTop: '20px', 
                            textAlign: 'center',
                            fontSize: '16px',
                            color: '#aaa'
                        }
                    }, '‚å®Ô∏è ÌôîÏÇ¥Ìëú ÌÇ§Î°ú ÎÑàÍµ¨Î¶¨Î•º ÏõÄÏßÅÏù¥ÏÑ∏Ïöî!')
                ),

                // Í≤åÏûÑ Ïò§Î≤Ñ ÌôîÎ©¥
                gameState === 'lost' && React.createElement('div', { style: { textAlign: 'center' } },
                    React.createElement('h1', { style: { fontSize: '48px', color: '#FF6B6B' } }, 'Í≤åÏûÑ Ïò§Î≤Ñ!'),
                    React.createElement('p', { 
                        style: { fontSize: '32px', margin: '30px 0' }
                    }, `ÏµúÏ¢Ö Ï†êÏàò: ${score}`),
                    React.createElement('p', { 
                        style: { fontSize: '24px', marginBottom: '20px' }
                    }, `Î†àÎ≤® ${level}ÍπåÏßÄ ÎèÑÎã¨ÌñàÏäµÎãàÎã§!`),
                    React.createElement('p', { 
                        style: { fontSize: '18px', marginBottom: '30px', color: '#4ECDC4' }
                    }, 'Ï†êÏàòÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§ üéâ'),
                    React.createElement('div', {
                        style: { display: 'flex', gap: '20px', justifyContent: 'center' }
                    },
                        React.createElement('button', {
                            onClick: startGame,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#FFD700',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'Îã§Ïãú ÏãúÏûë'),
                        React.createElement('button', {
                            onClick: () => {
                                setGameState('menu');
                                setShowRankings(true);
                                loadRankings();
                            },
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#4ECDC4',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'Îû≠ÌÇπ Î≥¥Í∏∞')
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(RaccoonGame));
    </script>
</body>
</html>